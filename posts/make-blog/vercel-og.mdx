---
title: ì»¤ë²„ ì´ë¯¸ì§€ ìë™ ìƒì„±í•˜ê¸° (@vercel/og)
description: @vercel/ogë¥¼ ì‚¬ìš©í•´ ì»¤ë²„ ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•©ë‹ˆë‹¤.
cover:
tags: blog, next.js, vercel, vercel/og, og, image, generation, ì»¤ë²„, ì´ë¯¸ì§€
date: 2024-10-25
author: yeahx4
series: make-blog
seriesIndex: 4
coverTitle: Cover Image Generation
coverSub: feat. @vercel/og
coverTs: 90
coverBg: 7C6CAF
coverColor: ffffff
update: 2024-10-26
---

ì§€ê¸ˆê¹Œì§€ ì»¤ë²„ ì´ë¯¸ì§€ëŠ” ì§ì ‘ png íŒŒì¼ë¡œ ë§Œë“¤ì–´ì„œ ì§ì ‘ ì—°ê²°ì‹œí‚¤ëŠ” ë°©í–¥ì´ì—ˆìŠµë‹ˆë‹¤. ê·¸ëŸ°ë° ë§ì€ ê²½ìš°
ì»¤ë²„ ì´ë¯¸ì§€ëŠ” ë‹¨ìˆœíˆ ë‹¨ìƒ‰ ë°°ê²½ì— ê°„ë‹¨í•œ ê¸€ìì…ë‹ˆë‹¤. í˜•ì‹ì´ ê³„ì† ë°˜ë³µë˜ëŠ” ì´ë¯¸ì§€ë¥¼ ê³„ì† ìˆ˜ì‘ì—…ìœ¼ë¡œ
ë§Œë“¤ì–´ì„œ ë„£ì–´ì£¼ëŠ” ê²ƒì€ êµ‰ì¥íˆ í”¼ê³¤í•  ë¿ ì•„ë‹ˆë¼ ì‹œê°„ ë‚­ë¹„ì…ë‹ˆë‹¤. Vercelì—ì„œëŠ” ë°˜ë³µë˜ê³  ë²ˆê±°ë¡œìš´
ì´ë¯¸ì§€ë¥¼ ìë™ìœ¼ë¡œ ìƒì„±í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.

# @vercel/og

[@vercel/og](https://vercel.com/docs/functions/og-image-generation)ëŠ” open
graphì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ image generationì„ ì œê³µí•©ë‹ˆë‹¤. ê³µì‹ ë¬¸ì„œì— ë”°ë¥´ë©´ ì‰½ê³  ë¹ ë¥´ê²Œ
ì„±ëŠ¥ ì¢‹ì€ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì¼ë‹¨ npmì„ í†µí•´ vercel/ogë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```bash
npm install @vercel/og
```

ì •ìƒì ì¸ ì‘ë™ì„ ìœ„í•´ì„œ Node.js 20 ì´ìƒê³¼ Next.js 12 ì´ìƒì„ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤. Nextì˜
[Api Routes](https://nextjs.org/docs/pages/building-your-application/routing/api-routes)ë¥¼
í†µí•´ ì´ë¯¸ì§€ë¥¼ ë°›ëŠ” ì—”ë“œí¬ì¸íŠ¸ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. JSX ì»´í¬ë„ŒíŠ¸ë¥¼ `ImageResponse`ì— ì „ë‹¬í•´ì„œ
JSXë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ ìŠ¤íƒ€ì¼ê³¼ flexê°™ì€ CSSë¥¼ ì§€ì›í•©ë‹ˆë‹¤.
ì•„ë˜ì˜ ì½”ë“œë¥¼ `/app/api/posts/image/route.tsx`ì— ì‘ì„±í•˜ê³  ë¸Œë¼ìš°ì €ì—ì„œ `/api/posts/image`ë¡œ
ì ‘ê·¼í•˜ë©´ í•˜ì–€ ë°°ê²½ì— Helloê°€ ì íŒ ì´ë¯¸ì§€ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
import { ImageResponse } from "next/og";

export async function GET() {
  return new ImageResponse(
    (
      <div
        style={{
          fontSize: 40,
          color: "black",
          background: "white",
          width: "100%",
          height: "100%",
          padding: "50px 200px",
          textAlign: "center",
          justifyContent: "center",
          alignItems: "center",
        }}
      >
        ğŸ‘‹ Hello
      </div>
    ),
    {
      width: 1200,
      height: 630,
    }
  );
}
```

# ì»¤ìŠ¤í„°ë§ˆì´ì§•

## í°íŠ¸ ì¶”ê°€í•˜ê¸°

ê¸°ë³¸ì ìœ¼ë¡œ sans í°íŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ”ë° ì»¤ë²„ ì´ë¯¸ì§€ì— ì“°ê¸°ì—” ë³„ë¡œ ì˜ˆì˜ì§€ ì•ŠìŠµë‹ˆë‹¤. vercel/og ì—ì„œëŠ”
ttfíŒŒì¼(ë˜ëŠ” ë‹¤ë¥¸ í°íŠ¸ íŒŒì¼)ì„ í†µí•´ ì§ì ‘ í°íŠ¸ë¥¼ ì§€ì •í•˜ëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì¼ë‹¨ ì‚¬ìš©í•  ttf íŒŒì¼ì„
`/public/font/font.ttf`ì— ë†“ìŠµë‹ˆë‹¤. ì €ëŠ” ìƒì£¼ê³¶ê°ì²´ë¥¼ ì“¸ ì˜ˆì •ì´ë¼ `gotgam.ttf`ì— ë‘ì—ˆìŠµë‹ˆë‹¤.
ê·¸ë¦¬ê³ , `ImageResponse`ì˜ ì„¤ì •ì— í°íŠ¸ë¥¼ ì¶”ê°€í•´ì•¼ í•©ë‹ˆë‹¤.

```ts
const font = await fetch(getUrl("/font/gotgam.ttf")).then((res) =>
  res.arrayBuffer()
);

// ...

  {
    width: 1200,
    height: 630,
    fonts: [
      {
        name: "gotgam",
        data: font,
        style: "normal",
      },
    ],
  }

//...
```

ì°¸ê³ ë¡œ ì„œë²„ì‚¬ì´ë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— fetchì˜ URLì„ ê·¸ëƒ¥ `/font/example.ttf`ì²˜ëŸ¼ ì“°ë©´
ì œëŒ€ë¡œ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•©ë‹ˆë‹¤. ê·¸ë˜ì„œ `getUrl`ì´ë¼ëŠ” ìœ í‹¸ í•¨ìˆ˜ë¥¼ í•˜ë‚˜ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. Host í—¤ë”ë¥¼
ì½ì–´ì„œ ì„œë²„ì‚¬ì´ë“œì—ì„œë„ í˜„ì¬ URLì„ ì½ì„ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

```ts
import { headers } from "next/headers";
import { join } from "path";

export const getBaseUrl = () => {
  const headersList = headers();
  const host = headersList.get("host");
  const protocol = headersList.get("x-forwarded-proto") ?? "http";

  return `${protocol}://${host}`;
};

export const getUrl = (path: string) => {
  return join(getBaseUrl(), path);
};
```

## íŒŒë¼ë¯¸í„°

`/api/posts/image`ë¡œ GET ìš”ì²­ì„ ë‚ ë¦¬ë©´ ì´ë¯¸ì§€ë¥¼ ë³´ë‚´ì£¼ëŠ”ë°, ì´ë¯¸ì§€ì˜ ë‚´ìš©ì„ ì§ì ‘ ì •í•  ìˆ˜
ìˆì–´ì•¼ í•©ë‹ˆë‹¤. ì €ëŠ” ì£¼ì œëª©ê³¼ ë¶€ì œëª©ì„ ì‚¬ìš©í•  ì˜ˆì •ì´ê¸° ë•Œë¬¸ì— ì•„ë˜ì™€ ê°™ì€ íŒŒë¼ë¯¸í„°ë¥¼ ì •í–ˆìŠµë‹ˆë‹¤.

- `color`: ê¸€ì”¨ ìƒ‰
- `bg` : ë°°ê²½ìƒ‰
- `title` : ì£¼ì œëª© ë‚´ìš©
- `sub` : ë¶€ì œëª© ë‚´ìš©
- `ts` : ì£¼ì œëª© í°íŠ¸ í¬ê¸° (title size)
- `ss` : ë¶€ì œëª© í°íŠ¸ í¬ê¸° (subtitle size)

paramì„ í†µí•´ `.../image?color=ff0000&title=hello` ê°™ì€ ëª¨ìŠµìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆê²Œ
ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.

```ts
export async function GET(req: NextRequest) {
  const query = req.nextUrl.searchParams;
  const param = Object.fromEntries(query.entries());

  const { color, bg, title, sub, ts, ss } = param;

  const font = await fetch(getUrl("/font/gotgam.ttf")).then((res) =>
    res.arrayBuffer()
  );

// ...
```

ì´ì œ ì € íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§€ê³  JSXë¥¼ ë§Œë“¤ì–´ì„œ `ImageResponse`ì— ë¦¬í„´í•˜ë©´ ë©ë‹ˆë‹¤.

```tsx
// ...

return new ImageResponse(
    (
      <div
        style={{
          color: `#${color || "000"}`,
          background: `#${bg || "fff"}`,
          width: "100%",
          height: "100%",
          padding: "50px 200px",
          textAlign: "center",
          justifyContent: "center",
          alignItems: "center",
          display: "flex",
          flexDirection: "column",
          fontFamily: "gotgam",
        }}
      >
        <span
          style={{
            fontSize: parseInt(ts || "72"),
            fontWeight: "bolder",
            marginBottom: 20,
          }}
        >
          {title}
        </span>
        <span
          style={{
            fontSize: parseInt(ss || "48"),
          }}
        >
          {sub}
        </span>
      </div>
    ),
    {
      width: 1200,
      height: 630,
      fonts: [
        {
          name: "gotgam",
          data: font,
          style: "normal",
        },
      ],
    }
  );
}
```

ê·¸ëŸ¼ ì•„ë˜ URLë¡œ í•œë²ˆ ìš”ì²­ì„ ë‚ ë ¤ì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ë´…ì‹œë‹¤.

```url
/api/posts/image?title=Main%20Title&sub=Sub%20Title&ts=120&ss=72&bg=000&color=fff
```

![cover example](/api/posts/image?title=Main%20Title&sub=Sub%20Title&ts=120&ss=72&bg=000&color=fff)

ì˜ ì‘ë™í•˜ë„¤ìš”! í•œë²ˆ ë§Œë“¤ì–´ì§„ ì´ë¯¸ì§€ëŠ” ìë™ìœ¼ë¡œ ìºì‹±ë˜ì–´ ë§¤ë²ˆ ìƒˆë¡œ ë§Œë“¤ì§€ ì•ŠìŠµë‹ˆë‹¤.

# êµì²´

ì´ì œ ê¸°ì¡´ì˜ coverë¥¼ image generationìœ¼ë¡œ êµì²´í•´ì•¼ í•©ë‹ˆë‹¤. ê·¸ë ‡ë‹¤ê³  ê¸°ì¡´ì— ì‚¬ìš©í•˜ë˜ ë°©ì‹ì„
ì™„ì „íˆ íì§€í•˜ê³  ì‹¶ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤. í•„ìš”í•  ê²½ìš° ì´ë¯¸ì§€ë¡œë„ ì»¤ë²„ ì´ë¯¸ì§€ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤. ê·¸ë˜ì„œ
frontmatterì— ëª‡ê°€ì§€ íŒŒë¼ë¯¸í„°ë¥¼ ë” ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. coverê°€ ìˆì„ ê²½ìš° ì´ì „ì²˜ëŸ¼ cover URLë¡œ
ì´ë¯¸ì§€ë¥¼ í‘œì‹œí•˜ê³  ì•„ë‹ˆë¼ë©´ frontmatterì—ì„œ ë‹¤ë¥¸ ê°’ë“¤ì„ ì½ì–´ì„œ ì»¤ë²„ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤.
ì•„ë˜ í•¨ìˆ˜ë¥¼ í†µí•´ frontmatterì—ì„œ URLì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```ts
export const buildCoverUrl = (meta: PostMeta) => {
  let url = "/api/posts/image?";

  if (meta.coverTitle) url += `title=${encodeURIComponent(meta.coverTitle)}&`;
  if (meta.coverSub) url += `sub=${encodeURIComponent(meta.coverSub)}&`;
  if (meta.coverColor) url += `color=${encodeURIComponent(meta.coverColor)}&`;
  if (meta.coverBg) url += `bg=${encodeURIComponent(meta.coverBg)}&`;
  if (meta.coverTs) url += `ts=${meta.coverTs}&`;
  if (meta.coverSs) url += `ss=${meta.coverSs}&`;

  return url;
};
```

ì´ì œ ì´ URLì„ ì»¤ë²„ ì´ë¯¸ì§€ ëŒ€ì‹ ì— ì‚¬ìš©í•˜ë©´ ë˜ê² ë„¤ìš”.

```tsx
<img
  src={
    meta.cover
      ? `/img/cover/${meta.cover}`
      : buildCoverUrl(meta)
  }
  alt={meta.title}
  className="w-full h-48 object-cover"
/>
```

ë˜‘ê°™ì€ ì½”ë“œë¥¼ í¬ìŠ¤íŠ¸ í˜ì´ì§€ì˜ metadataì—ë„ ì ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

ì´ì œ ë‹¨ìˆœíˆ ë‹¨ìƒ‰ ë°°ê²½ì— ê¸€ì”¨ë¥¼ ì“°ê¸° ìœ„í•´ì„œ ë‹¤ë¥¸ ì‚¬ì´íŠ¸ë‚˜ í”„ë¡œê·¸ë¨ì„ ì¼œì„œ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ê³ , ê·¸ ì´ë¯¸ì§€ë¥¼
ë‹¤ìš´ë¡œë“œì—ì„œ public í´ë”ì— ë„£ê³ , ê·¸ê±¸ ë‹¤ì‹œ ì—°ê²°í•˜ëŠ” ì‘ì—…ì„ í•˜ì§€ ì•Šì•„ë„ ë©ë‹ˆë‹¤. í¬ìŠ¤íŠ¸ ë§ˆí¬ë‹¤ìš´ íŒŒì¼ì„
ë²—ì–´ë‚˜ì§€ ì•Šê³ ë„ í¸í•˜ê²Œ ì»¤ë²„ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤!